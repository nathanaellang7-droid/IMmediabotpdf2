<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEO PDF Bulk Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#eef1ff; }
.container { max-width:1200px; margin:auto; padding:20px; }
table { width:100%; border-collapse:collapse; }
th,td { border:1px solid #ddd; padding:8px; }
input { width:100%; padding:6px; }
.preview img { width:70px; height:100px; object-fit:cover; }
button { padding:12px 20px; margin-top:15px; background:#102060; color:#fff; border:none; cursor:pointer; }
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“š SEO PDF Bulk Generator</h1>

<table>
<thead>
<tr>
<th>OUTPUT FILE NAME</th>
<th>TITLE PDF (SEO)</th>
<th>TITLE BOOK</th>
<th>AUTHOR</th>
<th>DOWNLOAD LINK</th>
<th>ASIN</th>
<th>Preview</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<button onclick="addRow()">âž• Add Row</button>
<button onclick="generateZIP()">ðŸ“¦ Generate ZIP</button>
</div>

<script>
const rows = document.getElementById('rows');
addRow();

/* ========= TEXT VARIATION DATA ========= */
const TEXT_VARIANTS = [
  'This preview page introduces key concepts discussed throughout the ebook.',
  'This page provides a short overview of ideas explored in the full publication.',
  'This section highlights themes that are expanded in later chapters.',
  'This preview contains selected information from the original ebook.',
  'This page summarizes important ideas presented in the complete book.'
];

const CTA_VARIANTS = [
  'To download the full ebook, please return to page 1 and click the download button.',
  'For access to the complete PDF, go back to page 1 and use the download link.',
  'The full ebook is available by returning to page 1 and clicking download.',
  'To continue reading, please return to the first page and download the PDF.'
];

/* ========= SLUG ========= */
function slugify(text) {
  return text.toString().normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'')
    .toLowerCase().trim()
    .replace(/[^a-z0-9]+/g,'-')
    .replace(/^-+|-+$/g,'');
}

/* ========= IMAGE RESIZE (ULTRA LIGHT) ========= */
async function loadAndResizeImage(src) {
  const img = new Image();
  img.src = src;
  await new Promise(r => img.onload = r);

  const MAX = 1000;
  const ratio = Math.min(MAX / img.width, MAX / img.height, 1);

  const canvas = document.createElement('canvas');
  canvas.width = img.width * ratio;
  canvas.height = img.height * ratio;

  canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
  return canvas.toDataURL('image/jpeg', 0.55);
}

/* ========= UI ========= */
function addRow() {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="out"></td>
    <td><input class="pdf"></td>
    <td><input class="title"></td>
    <td><input class="author"></td>
    <td><input class="link"></td>
    <td><input class="asin" oninput="preview(this)"></td>
    <td class="preview"><img></td>
  `;
  rows.appendChild(tr);
}

function preview(el) {
  el.closest('tr').querySelector('img').src =
    `https://images-na.ssl-images-amazon.com/images/P/${el.value}.01.LZZZZZZZ.jpg`;
}

/* ========= PDF BUILDER ========= */
async function buildPDF(data) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4', compress:true });

  doc.setProperties({
    title: data.title_pdf,
    author: data.author,
    subject: data.title_book,
    keywords: `${data.title_book}, ebook, pdf, download`
  });

  const W = 595, H = 842;

  /* PAGE 1 */
  const cover = new Image();
  cover.crossOrigin = "anonymous";
  cover.src = `https://images-na.ssl-images-amazon.com/images/P/${data.asin}.01.LZZZZZZZ.jpg`;
  await new Promise(r => cover.onload = r);

  doc.addImage(cover,'JPEG',(W-220)/2,40,220,330,undefined,'FAST');

  doc.setFont('times','bold');
  doc.setFontSize(18);
  doc.text(data.title_pdf,W/2,410,{align:'center'});

  doc.setFont('times','normal');
  doc.setFontSize(12);
  doc.text(
`Free ebook preview: ${data.title_book}
Author: ${data.author}

This PDF contains a preview of the ebook.
To download the complete version, click the button below.`,
W/2,460,{align:'center',maxWidth:420});

  /* BUTTON */
  const btnX=(W-280)/2, btnY=685, btnW=280, btnH=52;
  doc.setFillColor(8,16,60);
  doc.roundedRect(btnX+4,btnY+4,btnW,btnH,10,10,'F');
  doc.setFillColor(16,32,96);
  doc.roundedRect(btnX,btnY,btnW,btnH,10,10,'F');
  doc.setFont('helvetica','bold');
  doc.setFontSize(16);
  doc.setTextColor(255,255,255);
  doc.text('DOWNLOAD PDF',W/2,btnY+btnH/2+5,{align:'center'});
  doc.link(btnX,btnY,btnW,btnH,{url:data.link});
  doc.setTextColor(0,0,0);

  /* PAGES */
  const TOTAL = Math.random() > 0.5 ? 21 : 20;
  const IMAGE_PAGES = 9;
  const TEXT_PAGES = TOTAL - 1 - IMAGE_PAGES;

  const previews = ['previews/p1.jpg','previews/p2.jpg','previews/p3.jpg','previews/p4.jpg']
    .sort(()=>0.5-Math.random());

  /* IMAGE PAGES */
  for(let i=0;i<IMAGE_PAGES;i++){
    doc.addPage();
    const imgData = await loadAndResizeImage(previews[i%previews.length]);
    doc.addImage(imgData,'JPEG',0,0,W,H,undefined,'FAST');
  }

  /* TEXT PAGES */
  for(let i=0;i<TEXT_PAGES;i++){
    doc.addPage();
    const page = 11 + i;
    const text = TEXT_VARIANTS[i % TEXT_VARIANTS.length];
    const cta = CTA_VARIANTS[i % CTA_VARIANTS.length];

    doc.setFont('times','normal');
    doc.setFontSize(12);
    doc.text(
`Preview Page ${page}

${data.title_book}
Author: ${data.author}

${text}

${cta}

Thank you for reading.`,
40,80,{maxWidth:520});
  }

  return doc.output('blob');
}

/* ========= ZIP ========= */
async function generateZIP() {
  const zip = new JSZip();
  const trs = rows.querySelectorAll('tr');

  for(const tr of trs){
    const data = {
      output: tr.querySelector('.out').value,
      title_pdf: tr.querySelector('.pdf').value,
      title_book: tr.querySelector('.title').value,
      author: tr.querySelector('.author').value,
      link: tr.querySelector('.link').value,
      asin: tr.querySelector('.asin').value
    };
    if(!data.asin) continue;

    const blob = await buildPDF(data);
    const name = slugify(data.output || data.title_book);
    zip.file(`${name}.pdf`, blob);
  }

  saveAs(await zip.generateAsync({type:'blob'}),'bulk-pdfs.zip');
}
</script>
</body>
</html>
